<h1 id="runners">Runners</h1>

<p>In GitLab CI, Runners run your <a href="../yaml/README.md">yaml</a>.
A runner is an isolated (virtual) machine that picks up builds
through the coordinator API of GitLab CI.</p>

<p>A runner can be specific to a certain project or serve any project
in GitLab CI. A runner that serves all projects is called a shared runner.</p>

<h2 id="shared-vs-specific-runners">Shared vs. Specific Runners</h2>

<p>A runner that is specific only runs for the specified project. A shared runner
can run jobs for every project that has enabled the option
<code class="prettyprint">Allow shared runners</code>.</p>

<p><strong>Shared runners</strong> are useful for jobs that have similar requirements,
between multiple projects. Rather than having multiple runners idling for
many projects, you can have a single or a small number of runners that handle
multiple projects. This makes it easier to maintain and update runners.</p>

<p><strong>Specific runners</strong> are useful for jobs that have special requirements or for
projects with a very demand. If a job has certain requirements, you can set
up the specific runner with this in mind, while not having to do this for all
runners. For example, if you want to deploy a certain project, you can setup
a specific runner to have the right credentials for this.</p>

<p>Projects with high demand of CI activity can also benefit from using specific runners.
By having dedicated runners you are guaranteed that the runner is not being held
up by another project&rsquo;s jobs.</p>

<p>You can set up a specific runner to be used by multiple projects. The difference
with a shared runner is that you have to enable each project explicitly for
the runner to be able to run its jobs.</p>

<p>Specific runners do not get shared with forked projects automatically.
A fork does copy the CI settings (jobs, allow shared, etc) of the cloned repository.</p>

<h1 id="creating-and-registering-a-runner">Creating and Registering a Runner</h1>

<p>There are several ways to create a runner. Only after creation, upon
registration its status as Shared or Specific is determined.</p>

<p><a href="https://gitlab.com/gitlab-org/gitlab-ci-multi-runner/#installation">See the documentation for</a>
the different methods of installing a Runner instance.</p>

<p>After installing the runner, you can either register it as <code class="prettyprint">Shared</code> or as <code class="prettyprint">Specific</code>.
You can only register a Shared Runner if you have admin access to the GitLab instance.</p>

<h2 id="registering-a-shared-runner">Registering a Shared Runner</h2>

<p>You can only register a shared runner if you are an admin on the linked
GitLab instance.</p>

<p>Grab the shared-runner token on the <code class="prettyprint">admin/runners</code> page of your GitLab CI
instance.</p>

<p><img alt="shared token" src="../../../assets/images/shared_runner.png" /></p>

<p>Now simply register the runner as any runner:</p>
<pre class="highlight plaintext"><code>sudo gitlab-runner register
</code></pre>

<p>Note that you will have to enable <code class="prettyprint">Allows shared runners</code> for each project
that you want to make use of a shared runner. This is by default <code class="prettyprint">off</code>.</p>

<h2 id="registering-a-specific-runner">Registering a Specific Runner</h2>

<p>Registering a specific can be done in two ways:</p>

<ol>
<li>Creating a runner with the project registration token</li>
<li>Converting a shared runner into a specific runner (one-way, admin only)</li>
</ol>

<p>There are several ways to create a runner instance. The steps below only
concern registering the runner on GitLab CI.</p>

<h3 id="registering-a-specific-runner-with-a-project-registration-token">Registering a Specific Runner with a Project Registration token</h3>

<p>To create a specific runner without having admin rights to the GitLab instance,
visit the project you want to make the runner work for in GitLab CI.</p>

<p>Click on the runner tab and use the registration token you find there to
setup a specific runner for this project.</p>

<p><img alt="project runners in GitLab CI" src="../../../assets/images/project_specific.png" /></p>

<p>To register the runner, run the command below and follow instructions:</p>
<pre class="highlight plaintext"><code>sudo gitlab-runner register
</code></pre>

<h3 id="making-an-existing-shared-runner-specific">Making an existing Shared Runner Specific</h3>

<p>If you are an admin on your GitLab instance,
you can make any shared runner a specific runner, <em>but you can not
make a specific runner a shared runner</em>.</p>

<p>To make a shared runner specific, go to the runner page (<code class="prettyprint">/admin/runners</code>)
and find your runner. Add any projects on the left to make this runner
run exclusively for these projects, therefore making it a specific runner.</p>

<p><img alt="making a shared runner specific" src="../../../assets/images/shared_to_specific_admin.png" /></p>

<h2 id="using-shared-runners-effectively">Using Shared Runners Effectively</h2>

<p>If you are planning to use shared runners, there are several things you
should keep in mind.</p>

<h3 id="use-tags">Use Tags</h3>

<p>You must setup a runner to be able to run all the different types of jobs
that it may encounter on the projects it&rsquo;s shared over. This would be
problematic for large amounts of projects, if it wasn&rsquo;t for tags.</p>

<p>By tagging a Runner for the types of jobs it can handle, you can make sure
shared runners will only run the jobs they are equipped to run.</p>

<p>For instance, at GitLab we have runners tagged with &ldquo;rails&rdquo; if they contain
the appropriate dependencies to run Rails test suites.</p>

<h3 id="be-careful-with-sensitive-information">Be Careful with Sensitive Information</h3>

<p>If you can run a build on a runner, you can get access to any code it runs
and get the token of the runner. With shared runners, this means that anyone
that runs jobs on the runner, can access anyone else&rsquo;s code that runs on the runner.</p>

<p>In addition, because you can get access to the runner token, it is possible
to create a clone of a runner and submit false builds, for example.</p>

<p>The above is easily avoided by restricting the usage of shared runners
on large public GitLab instances and controlling access to your GitLab instance.</p>

<h3 id="forks">Forks</h3>

<p>Whenever a project is forked, it copies the settings of the jobs that relate
to it. This means that if you have shared runners setup for a project and
someone forks that project, the shared runners will also serve jobs of this
project.</p>

<h1 id="attack-vectors-in-runners">Attack vectors in runners</h1>

<p>Mentioned briefly earlier, but the following things of runners can be exploited.
We&rsquo;re always looking for contributions that can mitigate these <a href="https://gitlab.com/gitlab-org/gitlab-ci-multi-runner/blob/master/docs/security/index.md">Security Considerations</a>.</p>
