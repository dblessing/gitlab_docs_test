<h2 id="test-clojure-applications">Test Clojure applications</h2>

<p>This example will guide you how to run tests in your Clojure application.</p>

<p>You can checkout the example <a href="https://gitlab.com/dzaporozhets/clojure-web-application">source</a> and check <a href="https://ci.gitlab.com/projects/6306">CI status</a>.</p>

<h3 id="configure-project">Configure project</h3>

<p>This is what the <code class="prettyprint">.gitlab-ci.yml</code> file looks like for this project:</p>
<pre class="highlight yaml"><code><span class="s">variables</span><span class="pi">:</span>
  <span class="s">POSTGRES_DB</span><span class="pi">:</span> <span class="s">sample-test</span>
  <span class="s">DATABASE_URL</span><span class="pi">:</span> <span class="s2">"</span><span class="s">postgresql://postgres@postgres:5432/sample-test"</span>

<span class="s">before_script</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="s">apt-get update -y</span>
  <span class="pi">-</span> <span class="s">apt-get install default-jre postgresql-client -y</span>
  <span class="pi">-</span> <span class="s">wget https://raw.githubusercontent.com/technomancy/leiningen/stable/bin/lein</span>
  <span class="pi">-</span> <span class="s">chmod a+x lein</span>
  <span class="pi">-</span> <span class="s">export LEIN_ROOT=1</span>
  <span class="pi">-</span> <span class="s">PATH=$PATH:.</span>
  <span class="pi">-</span> <span class="s">lein deps</span>
  <span class="pi">-</span> <span class="s">lein migratus migrate</span>

<span class="s">test</span><span class="pi">:</span> 
  <span class="s">script</span><span class="pi">:</span> 
    <span class="pi">-</span> <span class="s">lein test</span>
</code></pre>

<p>In before script we install JRE and <a href="http://leiningen.org/">Leiningen</a>. 
Sample project uses <a href="https://github.com/yogthos/migratus">migratus</a> library to manage database migrations. 
So we added database migration as last step of <code class="prettyprint">before_script</code> section</p>

<p>You can use public runners available on <code class="prettyprint">gitlab.com</code> for testing your application with such configuration.</p>
